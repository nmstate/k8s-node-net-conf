#!/usr/libexec/platform-python

import os
import sys
import time
import io
from contextlib import redirect_stdout

nmstatectl_path = "/usr/bin/nmstatectl"
pipe = sys.argv[1]

with open(nmstatectl_path) as nmstatectl_file:
    nmstatectl = nmstatectl_file.read()
    sys.argv = [nmstatectl_path, "show"]
    while True:
        with open(pipe, "w") as fifo, redirect_stdout(fifo):
            try:
                exec(nmstatectl)
            except SystemExit:
                pass
            sys.stdout.flush()

        # take some time for the other side to close the pipe
        time.sleep(1)
